<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Cobrinha</title>
    <style>
        .game-container {
            text-align: center;
        }

        #quadro {
            border: 2px solid #000;
            background: #ffc;
            display: block;
            margin: 0 auto;
        }

        .score {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #333;
        }

        .game-over {
            font-size: 32px;
            color: red;
            font-weight: bold;
            margin: 20px 0;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.js"
        integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
</head>

<body>
    <div class="game-container">
        <div class="score">Pontos: <span id="pontuacao">0</span></div>
        <canvas id="quadro" width="400" height="400"></canvas>
        <div id="game-over-message" class="game-over" style="display: none;">game over!</div>
    </div>

    <script>
        var canvas = $("#quadro")[0];
        var ctx = canvas.getContext("2d");

        var gameOver = false;
        var pontuacao = 0;
        var snake = [];
        var tamanhoQuadrado = 20;

        var comida = {
            "x": 0,
            "y": 0,
            "l": 15,
            "a": 15,
            "cor": "pink",

            desenharObjeto: function () {
                ctx.fillStyle = this.cor;
                ctx.fillRect(this.x, this.y, this.l, this.a);
            },

            posicionarAleatoriamente: function () {
                // posiciona a comida em uma grade para alinhar com a cobra
                this.x = Math.floor(Math.random() * (canvas.width / tamanhoQuadrado)) * tamanhoQuadrado;
                this.y = Math.floor(Math.random() * (canvas.height / tamanhoQuadrado)) * tamanhoQuadrado;
            }
        }

        function criaSegmentoSnake(x, y) {
            return {
                "x": x,
                "y": y,
                "l": tamanhoQuadrado,
                "a": tamanhoQuadrado,
                "cor": "blue",
                
                desenharObjeto: function () {
                    ctx.fillStyle = this.cor;
                    ctx.fillRect(this.x, this.y, this.l, this.a);
                   
                }
            };
        }

        function inicializarJogo() {
            snake = [];
            snake.push(criaSegmentoSnake(200, 200));
            
            // Direção inicial
            snake.direcaoX = 0;
            snake.direcaoY = 0;
            
            comida.posicionarAleatoriamente();
            pontuacao = 0;
            gameOver = false;
            $("#pontuacao").text(pontuacao);
            $("#game-over-message").hide();
        }

        function detectaColisaoComida() {
            var cabeca = snake[0];
            if (cabeca.x === comida.x && cabeca.y === comida.y) {
                pontuacao++;
                $("#pontuacao").text(pontuacao);
                
                // Adiciona um novo segmento no final da cobra
                var ultimoSegmento = snake[snake.length - 1];
                snake.push(criaSegmentoSnake(ultimoSegmento.x, ultimoSegmento.y));
                
                comida.posicionarAleatoriamente();
                return true;
            }
            return false;
        }

        function detectaColisaoConsigo() {
            var cabeca = snake[0];
            // Verifica se a cabeça colidiu com algum segmento do corpo
            for (var i = 1; i < snake.length; i++) {
                if (cabeca.x === snake[i].x && cabeca.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        function detectaLimite() {
            var cabeca = snake[0];
            if (cabeca.x < 0 || cabeca.y < 0 ||
                cabeca.x >= canvas.width || cabeca.y >= canvas.height) {
                return true;
            }
            return false;
        }

        function moverSnake() {
            if (snake.direcaoX === 0 && snake.direcaoY === 0) {
                return; // Cobra não está se movendo
            }

            // Move cada segmento para a posição do segmento anterior
            for (var i = snake.length - 1; i > 0; i--) {
                snake[i].x = snake[i - 1].x;
                snake[i].y = snake[i - 1].y;
            }

            // Move a cabeça na direção atual
            snake[0].x += snake.direcaoX * tamanhoQuadrado;
            snake[0].y += snake.direcaoY * tamanhoQuadrado;
        }

        function desenharTela() {
            if (gameOver) {
                return;
            }

            apagarTela();

            moverSnake();

            // Verifica colisões
            if (detectaLimite() || detectaColisaoConsigo()) {
                gameOver = true;
                $("#game-over-message").show();
                
                setTimeout(function () {
                    inicializarJogo();
                }, 3000);
                return;
            }

            detectaColisaoComida();

            for (var i = 0; i < snake.length; i++) {
                snake[i].desenharObjeto();
            }

            // Desenha a comida
            comida.desenharObjeto();

            setTimeout(function() {
                requestAnimationFrame(desenharTela);}, 150); // Controla a velocidade do jogo
        }

        function apagarTela() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Inicializa o jogo
        inicializarJogo();
        desenharTela();

        $(window).keydown(function (event) {
            if (!gameOver) {
                switch(event.which) {
                    case 37: // Seta esquerda
                        if (snake.direcaoX !== 1) { // Impede movimento contrário
                            snake.direcaoX = -1;
                            snake.direcaoY = 0;
                        }
                        break;
                    case 39: // Seta direita
                        if (snake.direcaoX !== -1) { // Impede movimento contrário
                            snake.direcaoX = 1;
                            snake.direcaoY = 0;
                        }
                        break;
                    case 38: // Seta cima
                        if (snake.direcaoY !== 1) { // Impede movimento contrário
                            snake.direcaoX = 0;
                            snake.direcaoY = -1;
                        }
                        break;
                    case 40: // Seta baixo
                        if (snake.direcaoY !== -1) { // Impede movimento contrário
                            snake.direcaoX = 0;
                            snake.direcaoY = 1;
                        }
                        break;
                }
            }
        });
    </script>
</body>

</html>
